function g(e){return e&&e.replace(/\(.*?\)/g,"").replace(/\s+/g," ").trim()}const m="https://parallelum.com.br/fipe/api/v1/carros";let u=null;async function p(){if(u)return u;try{return u=await(await fetch(`${m}/marcas`)).json()||[],u}catch(e){return console.error("getMakes error:",e),[]}}async function f(e){try{return(await(await fetch(`${m}/marcas/${e}/modelos`)).json())?.modelos||[]}catch(r){return console.error("getModelsByMake error:",r),[]}}async function $(e,r){try{return await(await fetch(`${m}/marcas/${e}/modelos/${r}/anos`)).json()||[]}catch(o){return console.error("getYearsByModel error:",o),[]}}async function j(e){try{const r=e.toLowerCase().trim(),o=await p(),s=[],i=o.filter(t=>t.nome.toLowerCase().includes(r));for(const t of i.slice(0,5)){const n=await f(t.codigo);for(const a of n.slice(0,10))s.push({make:t.nome,makeId:t.codigo,model:g(a.nome),modelId:a.codigo})}if(s.length<10)for(const t of o.slice(0,15)){const n=await f(t.codigo);for(const a of n){const c=g(a.nome);c.toLowerCase().includes(r)&&s.push({make:t.nome,makeId:t.codigo,model:c,modelId:a.codigo})}if(s.length>=20)break}return s.filter((t,n,a)=>n===a.findIndex(c=>c.make===t.make&&c.model===t.model)).slice(0,20)}catch(r){return console.error("searchCars error:",r),[]}}async function k(e,r){try{const o=g(r),s=[`${e} ${o}`,`${e} ${o.split(" ")[0]}`,`${e} car`];for(const i of s){const l=`https://en.wikipedia.org/w/api.php?action=query&origin=*&list=search&srsearch=${encodeURIComponent(i)}&format=json&srlimit=1`,a=(await(await fetch(l)).json()).query?.search?.[0]?.title;if(!a)continue;const c=`https://en.wikipedia.org/w/api.php?action=query&origin=*&titles=${encodeURIComponent(a)}&prop=pageimages&pithumbsize=600&format=json`,d=(await(await fetch(c)).json()).query?.pages||{},h=Object.values(d)[0];if(h?.thumbnail?.source)return h.thumbnail.source}return null}catch(o){return console.error("getCarImage error:",o),null}}async function C(e,r,o){try{if(!e||!r||!o)return console.warn("getCarDetails missing params:",{makeId:e,modelId:r,anoCodigo:o}),null;const s=`${m}/marcas/${e}/modelos/${r}/anos/${o}`;return await(await fetch(s)).json()||null}catch(s){return console.error("getCarDetails error:",s),null}}async function b(e){try{if(!Array.isArray(e)||e.length!==2)return"You must provide an array of exactly 2 car objects.";const[r,o]=e,s=void 0;if(!s)throw new Error("Missing Hugging Face API key in VITE_HUGGINGFACE_KEY");const l={model:"meta-llama/Llama-3.1-8B-Instruct:cerebras",messages:[{role:"user",content:`say the reason, Which car is better between these two give me your recommendation only based on these objects? Car A: ${JSON.stringify(r)} and Car B: ${JSON.stringify(o)}`}],stream:!1},t=await fetch("https://router.huggingface.co/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify(l)});if(!t.ok){const a=await t.text();throw new Error(`Hugging Face API error: ${t.status} ${a}`)}return(await t.json())?.choices?.[0]?.message?.content||"No recommendation returned."}catch(r){return console.error("compareCarsAI error:",r),`Error: ${r.message}`}}export{$ as a,C as b,b as c,k as g,j as s};
